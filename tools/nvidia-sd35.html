<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NVIDIA SD 3.5 Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background:#111;color:#eee }
    label,button,pre { display: block; margin-bottom: .8rem; }
    input[type=text], input[type=file], textarea { width: 100%; padding: .4rem;background:#222;border:1px solid #444;color:#eee;border-radius:3px; }
    button { padding: .5rem 1.2rem; background:#0ff3;color:#000;border:none;border-radius:3px;cursor:pointer }
    button:disabled { background:#555;cursor:not-allowed }
    #imgOut { max-width: 100%; margin-top:1rem;border:1px solid #444 }
    #log { white-space: pre; font-size:.75rem;background:#1a1a1a;padding:1rem;max-height:300px;overflow:auto }
    .tiny { font-size:.7rem;color:#888 }
  </style>
</head>
<body>
  <h2>NVIDIA SD 3.5 Generator</h2>
  <label>API Key
    <input id="key" type="text" placeholder="nvapi-..." />
  </label>
  <label>Prompt
    <textarea id="prompt" rows="3" placeholder="futuristic cyberpunk girl, neon lights"></textarea>
  </label>
  <label>Init Image (optional)
    <input id="initImg" type="file" accept="image/*" />
  </label>
  <label>Steps <span class="tiny">(lower = faster)</span>
    <input id="steps" type="range" min="10" max="50" value="25">
    <span id="stepVal">25</span>
  </label>
  <label>CFG Scale
    <input id="cfg" type="range" min="1" max="30" value="7">
    <span id="cfgVal">7</span>
  </label>
  <label>Seed (blank = random)
    <input id="seed" type="text" placeholder="12345">
  </label>
  <button id="go">Generate Image</button>
  <img id="imgOut" style="display:none" />
  <h3>JSON Log</h3>
  <pre id="log"></pre>
  
  <script>
    document.getElementById('steps').addEventListener('input', e => stepVal.textContent = e.target.value);
    document.getElementById('cfg').addEventListener('input', e => cfgVal.textContent = e.target.value);

    document.getElementById('go').onclick = async () => {
      const btn = document.getElementById('go'); btn.disabled = true;
      const log = document.getElementById('log');
      try {
        const key = document.getElementById('key').value.trim();
        const prompt = document.getElementById('prompt').value.trim();
        if (!key || !prompt) { alert('Need API key & prompt'); return; }
        
        const params = {
          prompt,
          steps: +document.getElementById('steps').value,
          cfg_scale: +document.getElementById('cfg').value,
          seed: document.getElementById('seed').value ? +document.getElementById('seed').value : null,
          aspect_ratio: "1:1", sampler: "DDIM", output_format: "png"
        };

        // Optional img2img base64
        const initFile = document.getElementById('initImg').files[0];
        if (initFile) {
          const buf = await initFile.arrayBuffer();
          const bytes = new Uint8Array(buf);
          const b64 = btoa(String.fromCharCode(...bytes));
          params.init_image = `data:${initFile.type};base64,${b64}`;
          params.strength = 0.75; // blend 25 % original
        }

        const body = JSON.stringify(params);
        log.textContent = 'POSTing to NVIDIAâ€¦';

        const r = await fetch('https://ai.api.nvidia.com/v1/img/genai/SDXL/v1', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${key}`,
            'Content-Type': 'application/json'
          },
          body
        });
        if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);

        const data = await r.json();
        log.textContent = JSON.stringify(data, null, 2);
        const url = data.image_url || data.data?.[0]?.url;
        if (url) {
          const img = document.getElementById('imgOut'); img.src = url; img.style.display = 'block';
        } else throw new Error('No image_url in response');
      } catch (e) {
        log.textContent = e.message;
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>